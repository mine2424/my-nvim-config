# 📊 Git統合ガイド (gitsigns.nvim)

gitsigns.nvimによる高度なGit統合機能の使用方法について説明します。

## ✨ 機能概要

### 🎯 主な機能
- **リアルタイム差分表示**: ファイル編集中にサイン列で変更を可視化
- **インラインステージング**: エディタ内でhunk単位のGit操作
- **Git blame情報**: 各行の作者・コミット情報表示
- **プレビュー機能**: 変更内容の詳細確認
- **高度なナビゲーション**: 効率的な変更箇所移動

## 🎨 視覚的表示

### サイン列のシンボル
| シンボル | 意味 | 色 |
|----------|------|---|
| `┃` | 追加された行 | 緑 |
| `┃` | 変更された行 | 青 |
| `_` | 削除された行 | 赤 |
| `‾` | 上部削除 | 赤 |
| `~` | 変更・削除 | 黄 |
| `┆` | 未追跡ファイル | グレー |

### Git blame表示
```
local config = wezterm.config_builder()  -- john_doe, 2024-06-30 - Initial WezTerm config
```

## ⌨️ キーバインド

### ナビゲーション
| キー | 機能 | 説明 |
|------|------|------|
| `]c` | 次のhunk | 次の変更箇所に移動 |
| `[c` | 前のhunk | 前の変更箇所に移動 |

### Hunk操作
| キー | 機能 | 説明 |
|------|------|------|
| `<leader>hs` | Hunkステージング | 現在のhunkをステージエリアに追加 |
| `<leader>hr` | Hunkリセット | 現在のhunkの変更を破棄 |
| `<leader>hp` | Hunkプレビュー | 変更内容をポップアップで表示 |
| `<leader>hu` | ステージ取り消し | hunkのステージングを取り消し |

### バッファ操作
| キー | 機能 | 説明 |
|------|------|------|
| `<leader>hS` | バッファステージング | ファイル全体をステージング |
| `<leader>hR` | バッファリセット | ファイル全体の変更を破棄 |

### 情報表示
| キー | 機能 | 説明 |
|------|------|------|
| `<leader>hb` | Git blame | 現在行の詳細blame情報表示 |
| `<leader>hd` | Diff表示 | 現在ファイルのdiff表示 |
| `<leader>hD` | Diff（HEAD~1） | HEAD~1との差分表示 |

### 表示切替
| キー | 機能 | 説明 |
|------|------|------|
| `<leader>tb` | Blame切替 | 行末blame表示のON/OFF |
| `<leader>td` | 削除行切替 | 削除された行の表示切替 |

### 範囲選択での操作
| モード | キー | 機能 |
|--------|------|------|
| Visual | `<leader>hs` | 選択範囲をステージング |
| Visual | `<leader>hr` | 選択範囲をリセット |

### テキストオブジェクト
| キー | 機能 | 使用例 |
|------|------|--------|
| `ih` | Hunk選択 | `dih` (hunk削除), `vih` (hunk選択) |

## 🚀 基本的な使用フロー

### 1. ファイル編集時の差分確認
```bash
# ファイルを編集すると自動的にサイン列に変更が表示される
nvim your_file.lua
# 編集すると左端に ┃ や _ などのシンボルが表示
```

### 2. 変更箇所の確認とナビゲーション
```bash
# 次の変更箇所に移動
]c

# 前の変更箇所に移動
[c

# 変更内容をプレビュー
<leader>hp
```

### 3. 変更のステージング
```bash
# 現在のhunkをステージング
<leader>hs

# ファイル全体をステージング
<leader>hS

# ステージングを取り消し
<leader>hu
```

### 4. 変更の破棄
```bash
# 現在のhunkの変更を破棄
<leader>hr

# ファイル全体の変更を破棄
<leader>hR
```

## 📋 実践的な使用例

### シナリオ1: 部分的なコミット
```bash
# 1. ファイルを編集（複数箇所を変更）
# 2. ]c で最初の変更箇所に移動
# 3. <leader>hp でプレビュー確認
# 4. <leader>hs で必要な部分のみステージング
# 5. ]c で次の変更箇所に移動
# 6. 必要に応じて繰り返し
```

### シナリオ2: 変更内容の確認
```bash
# 1. <leader>hd でファイル全体のdiff表示
# 2. <leader>hb で各行の変更履歴確認
# 3. <leader>tb でblame表示の切替
```

### シナリオ3: 間違った変更の修正
```bash
# 1. ]c で問題のある変更箇所に移動
# 2. <leader>hp で内容確認
# 3. <leader>hr で変更を破棄
```

## ⚙️ 設定のカスタマイズ

### Blame表示の調整
```lua
current_line_blame_opts = {
  delay = 1000,  -- 1秒後に表示（デフォルト）
  -- delay = 500,  -- より早く表示したい場合
}
```

### シンボルの変更
```lua
signs = {
  add          = { text = '┃' },  -- デフォルト
  -- add       = { text = '+' },  -- シンプルな表示
  change       = { text = '┃' },
  delete       = { text = '_' },
  topdelete    = { text = '‾' },
  changedelete = { text = '~' },
  untracked    = { text = '┆' },
}
```

### プレビューウィンドウの設定
```lua
preview_config = {
  border = 'single',     -- ボーダースタイル
  style = 'minimal',     -- ウィンドウスタイル
  relative = 'cursor',   -- カーソル位置に表示
}
```

## 🔧 トラブルシューティング

### 差分が表示されない場合
```bash
# Gitリポジトリ内で作業していることを確認
git status

# gitsignsが有効になっているか確認
:Gitsigns attach

# プラグインが読み込まれているか確認
:Lazy
```

### パフォーマンスが重い場合
```lua
-- 大きなファイルでの制限設定
max_file_length = 40000,  -- 40,000行まで（デフォルト）
-- max_file_length = 20000,  -- より小さな値に設定

-- 更新頻度の調整
update_debounce = 100,  -- 100ms（デフォルト）
-- update_debounce = 300,  -- より長い間隔
```

### キーバインドが効かない場合
```bash
# 他のプラグインとの競合確認
:verbose map <leader>hs

# gitsignsのキーマップ確認
:Gitsigns setloclist
```

## 🎯 ベストプラクティス

### 1. 効率的なワークフロー
- `]c` / `[c` でざっと変更を確認
- `<leader>hp` で詳細を確認してからステージング
- 関連する変更は一緒にステージング

### 2. コミット前のチェック
- すべての変更箇所を `]c` でレビュー
- 不要な変更は `<leader>hr` で破棄
- 意図的な変更のみステージング

### 3. チーム開発での活用
- `<leader>hb` でコード変更の履歴確認
- 他のメンバーの変更理由を把握
- レビュー時の参考情報として活用

---

**効率的なGit統合でコード品質を向上させましょう！ 📊✨**